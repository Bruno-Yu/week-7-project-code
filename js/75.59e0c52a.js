"use strict";(self["webpackChunkweek_7_project"]=self["webpackChunkweek_7_project"]||[]).push([[75],{1586:function(e,t,a){a.d(t,{Z:function(){return v}});var l=a(6252),o=a(3577);const r={class:"modal fade",id:"delModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},s={class:"modal-dialog",role:"document"},d={class:"modal-content border-0"},n={class:"modal-header bg-danger text-white"},i={class:"modal-title"},c=(0,l._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),u={class:"modal-body"},h=(0,l.Uk)(" 是否刪除 "),p={class:"text-danger"},_=(0,l.Uk)(" (刪除後將無法恢復)。 "),g={class:"modal-footer"},m=(0,l._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function w(e,t,a,w,b,k){return(0,l.wg)(),(0,l.iD)("div",r,[(0,l._)("div",s,[(0,l._)("div",d,[(0,l._)("div",n,[(0,l._)("h5",i,[(0,l._)("span",null,"刪除 "+(0,o.zw)(b.orderShow.title),1)]),c]),(0,l._)("div",u,[h,(0,l._)("strong",p,(0,o.zw)(b.orderShow.title),1),_]),(0,l._)("div",g,[m,(0,l._)("button",{type:"button",class:"btn btn-danger",onClick:t[0]||(t[0]=(...e)=>k.updateModal&&k.updateModal(...e))}," 確認刪除 ")])])])],512)}var b=a(7424),k=a.n(b),D={props:["order"],data(){return{modal:"",orderShow:{}}},watch:{order(){this.orderShow=this.order}},emits:["del-item"],methods:{openModal(){this.modal.show()},closeModal(){this.modal.hide()},updateModal(){this.$emit("del-item")}},mounted(){this.modal=new(k())(this.$refs.modal)}},y=a(3744);const f=(0,y.Z)(D,[["render",w]]);var v=f},8536:function(e,t,a){a.d(t,{Z:function(){return m}});var l=a(6252),o=a(3577),r=a(9963);const s={"aria-label":"Page navigation"},d={class:"pagination justify-content-center"},n=["aria-disabled"],i={key:0,class:"page-link"},c=["onClick"],u=["aria-disabled"];function h(e,t,a,h,p,_){return(0,l.wg)(),(0,l.iD)("nav",s,[(0,l._)("ul",d,[(0,l._)("li",{class:(0,o.C_)(["page-item",{disabled:!a.hasPre}])},[(0,l._)("a",{class:"page-link",href:"#",tabindex:"-1","aria-disabled":!a.hasPre,onClick:t[0]||(t[0]=(0,r.iM)((e=>_.emitData(a.currentPage-1)),["prevent"]))},"Previous",8,n)],2),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.totalPages,((e,t)=>((0,l.wg)(),(0,l.iD)("li",{class:(0,o.C_)(["page-item",{active:e===a.currentPage}]),key:t},[e===a.currentPage?((0,l.wg)(),(0,l.iD)("span",i,(0,o.zw)(e),1)):((0,l.wg)(),(0,l.iD)("a",{key:1,class:"page-link",href:"#",onClick:(0,r.iM)((t=>_.emitData(e)),["prevent"])},(0,o.zw)(e),9,c))],2)))),128)),(0,l._)("li",{class:(0,o.C_)(["page-item",{disabled:!a.hasNext}])},[(0,l._)("a",{class:"page-link",href:"#","aria-disabled":!a.hasNext,onClick:t[1]||(t[1]=(0,r.iM)((e=>_.emitData(a.currentPage+1)),["prevent"]))},"Next",8,u)],2)])])}var p={data(){return{}},props:["currentPage","hasPre","hasNext","totalPages"],methods:{emitData(e){this.$emit("click-page",e)}}},_=a(3744);const g=(0,_.Z)(p,[["render",h]]);var m=g},75:function(e,t,a){a.r(t),a.d(t,{default:function(){return _e}});var l=a(6252),o=a(3577),r=a(9963);const s=(0,l._)("h2",{class:"my-5 ms-2 fw-bold text-center"},"訂單管理頁面",-1),d={class:"table mt-4"},n=(0,l._)("thead",null,[(0,l._)("tr",null,[(0,l._)("th",{scope:"col"},"訂單號"),(0,l._)("th",{scope:"col"},"下訂時間"),(0,l._)("th",{scope:"col"},"Email"),(0,l._)("th",{scope:"col"},"購買品項"),(0,l._)("th",{scope:"col"},"應付金額"),(0,l._)("th",{scope:"col"},"是否付款"),(0,l._)("th",{scope:"col"},"編輯")])],-1),i={class:"list-group-numbered"},c={class:"text-right"},u={class:"form-check form-switch"},h=["id","onUpdate:modelValue","onChange"],p=["for"],_={key:0},g={key:1},m={class:"btn-group"},w=["onClick"],b=["onClick"];function k(e,t,a,k,D,y){const f=(0,l.up)("OrderDetail"),v=(0,l.up)("OrderDelete"),x=(0,l.up)("PaginationFooter");return(0,l.wg)(),(0,l.iD)(l.HY,null,[s,(0,l._)("table",d,[n,(0,l._)("tbody",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(D.orders,((e,t)=>((0,l.wg)(),(0,l.iD)("div",{key:t},[D.orders.length?((0,l.wg)(),(0,l.iD)("tr",{key:0,class:(0,o.C_)({"text-secondary":!e.is_paid})},[(0,l._)("td",null,(0,o.zw)(e.id),1),(0,l._)("td",null,(0,o.zw)(e.create_at),1),(0,l._)("td",null,(0,o.zw)(e.user.email),1),(0,l._)("td",null,[(0,l._)("ul",i,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.products,((e,t)=>((0,l.wg)(),(0,l.iD)("li",{class:"list-group-item",key:t},(0,o.zw)(e.product.title)+" 數量："+(0,o.zw)(e.qty)+" "+(0,o.zw)(e.product.unit),1)))),128))])]),(0,l._)("td",c,(0,o.zw)(e.total)+" 元",1),(0,l._)("td",null,[(0,l._)("div",u,[(0,l.wy)((0,l._)("input",{class:"form-check-input",type:"checkbox",id:`switch${e.id}`,"onUpdate:modelValue":t=>e.is_paid=t,onChange:t=>y.updatePaid(e)},null,40,h),[[r.e8,e.is_paid]]),(0,l._)("label",{class:"form-check-label",for:`switch${e.id}`},[e.is_paid?((0,l.wg)(),(0,l.iD)("span",_,"已付款")):((0,l.wg)(),(0,l.iD)("span",g,"未付款"))],8,p)])]),(0,l._)("td",null,[(0,l._)("div",m,[(0,l._)("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:t=>y.openModal(e)}," 檢視 ",8,w),(0,l._)("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:t=>y.openDelModal(e)}," 刪除 ",8,b)])])],2)):(0,l.kq)("",!0)])))),128))])]),(0,l.Wm)(f,{order:D.orderShow,ref:"orderDetail",onUpdatePaid:y.updatePaid},null,8,["order","onUpdatePaid"]),(0,l.Wm)(v,{order:D.orderShow,ref:"delModal",onDelItem:y.delOrder},null,8,["order","onDelItem"]),(0,l.Wm)(x,{"current-page":D.current_page,"has-pre":D.has_pre,"has-next":D.has_next,"total-pages":D.total_pages,onClickPage:y.getOrders},null,8,["current-page","has-pre","has-next","total-pages","onClickPage"])],64)}const D={class:"modal fade",tabindex:"-1",role:"dialog",id:"orderDetail","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},y={class:"modal-dialog modal-xl",role:"document"},f={class:"modal-content border-0"},v=(0,l._)("div",{class:"modal-header bg-dark text-white"},[(0,l._)("h5",{class:"modal-title",id:"exampleModalLabel"},[(0,l._)("span",null,"訂單細節")]),(0,l._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),x={class:"modal-body"},S={class:"row"},M={class:"col-md-4"},P=(0,l._)("h3",null,"用戶資料",-1),C={class:"table"},$={key:0},z=(0,l._)("th",{style:{width:"100px"}},"姓名",-1),O=(0,l._)("th",null,"Email",-1),Y=(0,l._)("th",null,"電話",-1),Z=(0,l._)("th",null,"地址",-1),F={class:"col-md-8"},U=(0,l._)("h3",null,"訂單細節",-1),N={class:"table"},q=(0,l._)("th",{style:{width:"100px"}},"訂單編號",-1),H=(0,l._)("th",null,"下單時間",-1),j=(0,l._)("th",null,"付款時間",-1),K={key:0},L={key:1},V=(0,l._)("th",null,"付款狀態",-1),W={key:0,class:"text-success"},E={key:1,class:"text-muted"},I=(0,l._)("th",null,"總金額",-1),T=(0,l._)("h3",null,"選購商品",-1),A={class:"table"},B=(0,l._)("thead",null,[(0,l._)("tr")],-1),G={class:"text-end"},J={class:"d-flex justify-content-end"},Q={class:"form-check"},R={class:"form-check-label",for:"flexCheckDefault"},X={key:0},ee={key:1},te={class:"modal-footer"},ae=(0,l._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function le(e,t,a,s,d,n){return(0,l.wg)(),(0,l.iD)("div",D,[(0,l._)("div",y,[(0,l._)("div",f,[v,(0,l._)("div",x,[(0,l._)("div",S,[(0,l._)("div",M,[P,(0,l._)("table",C,[d.orderShow.user?((0,l.wg)(),(0,l.iD)("tbody",$,[(0,l._)("tr",null,[z,(0,l._)("td",null,(0,o.zw)(d.orderShow.user.name),1)]),(0,l._)("tr",null,[O,(0,l._)("td",null,(0,o.zw)(d.orderShow.user.email),1)]),(0,l._)("tr",null,[Y,(0,l._)("td",null,(0,o.zw)(d.orderShow.user.tel),1)]),(0,l._)("tr",null,[Z,(0,l._)("td",null,(0,o.zw)(d.orderShow.user.address),1)])])):(0,l.kq)("",!0)])]),(0,l._)("div",F,[U,(0,l._)("table",N,[(0,l._)("tbody",null,[(0,l._)("tr",null,[q,(0,l._)("td",null,(0,o.zw)(d.orderShow.id),1)]),(0,l._)("tr",null,[H,(0,l._)("td",null,(0,o.zw)(n.CreateDate),1)]),(0,l._)("tr",null,[j,(0,l._)("td",null,[d.orderShow.paid_date?((0,l.wg)(),(0,l.iD)("span",K,(0,o.zw)(n.PaidDate),1)):((0,l.wg)(),(0,l.iD)("span",L,"時間不正確"))])]),(0,l._)("tr",null,[V,(0,l._)("td",null,[d.orderShow.is_paid?((0,l.wg)(),(0,l.iD)("strong",W,"已付款")):((0,l.wg)(),(0,l.iD)("span",E,"尚未付款"))])]),(0,l._)("tr",null,[I,(0,l._)("td",null,(0,o.zw)(d.orderShow.total),1)])])]),T,(0,l._)("table",A,[B,(0,l._)("tbody",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(d.orderShow.products,(e=>((0,l.wg)(),(0,l.iD)("tr",{key:e.id},[(0,l._)("th",null,(0,o.zw)(e.product.title),1),(0,l._)("td",null,(0,o.zw)(e.qty)+" / "+(0,o.zw)(e.product.unit),1),(0,l._)("td",G,(0,o.zw)(e.final_total),1)])))),128))])]),(0,l._)("div",J,[(0,l._)("div",Q,[(0,l.wy)((0,l._)("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":t[0]||(t[0]=e=>d.orderShow.is_paid=e)},null,512),[[r.e8,d.orderShow.is_paid]]),(0,l._)("label",R,[d.orderShow.is_paid?((0,l.wg)(),(0,l.iD)("span",X,"已付款")):((0,l.wg)(),(0,l.iD)("span",ee,"未付款"))])])])])])]),(0,l._)("div",te,[ae,(0,l._)("button",{type:"button",class:"btn btn-primary",onClick:t[1]||(t[1]=(...e)=>n.updateOrder&&n.updateOrder(...e))}," 修改付款狀態 ")])])])],512)}var oe=a(7424),re=a.n(oe),se={props:["order"],data(){return{status:{},modal:"",orderShow:{},isPaid:!1}},computed:{CreateDate(){const e=new Date(1e3*this.orderShow.create_at),t=e.getFullYear(),a=e.getMonth()+1,l=e.getDate(),o=`${t}/${a}/${l}`;return o},PaidDate(){const e=new Date(1e3*this.orderShow.is_paid),t=e.getFullYear(),a=e.getMonth()+1,l=e.getDate(),o=`${t}/${a}/${l}`;return o}},watch:{order(){this.orderShow=this.order}},methods:{openModal(){this.modal.show()},closeModal(){this.modal.hide()},updateOrder(){this.$emit("update-paid",this.orderShow)}},mounted(){this.modal=new(re())(document.querySelector("#orderDetail"))}},de=a(3744);const ne=(0,de.Z)(se,[["render",le]]);var ie=ne,ce=a(1586),ue=a(8536),he={data(){return{orders:{},isNew:!1,current_page:1,has_next:!1,has_pre:!1,total_pages:1,orderShow:{},currentPage:1}},components:{PaginationFooter:ue.Z,OrderDelete:ce.Z,OrderDetail:ie},methods:{dateTimeFormat(e){const t=new Date(1e3*e),a=t.getFullYear(),l=t.getMonth()+1,o=t.getDate(),r=`${a}/${l}/${o}`;return r},getOrders(e=1){this.currentPage=e;const t=`https://vue3-course-api.hexschool.io/v2//api/brunoyu2022/admin/orders?page=${e}`;this.$http.get(t,e).then((e=>{this.orders=e.data.orders.map((e=>({...e,create_at:this.dateTimeFormat(e.create_at)}))),this.current_page=e.data.pagination.current_page,this.has_next=e.data.pagination.has_next,this.has_pre=e.data.pagination.has_pre,this.total_pages=e.data.pagination.total_pages})).catch((e=>{this.isLoading=!1,alert(e.response,"錯誤訊息")}))},openModal(e){this.orderShow={...e},this.isNew=!1,this.$refs.orderDetail.openModal()},openDelModal(e){this.orderShow={...e},this.$refs.delModal.openModal()},updatePaid(e){const t=`https://vue3-course-api.hexschool.io/v2//api/brunoyu2022/admin/order/${e.id}`,a={is_paid:e.is_paid};this.$http.put(t,{data:a}).then((e=>{this.$refs.orderDetail.closeModal(),this.getOrders(this.currentPage),alert(e,"更新付款狀態")})).catch((e=>{alert(e.response,"錯誤訊息")}))},delOrder(){const e=`https://vue3-course-api.hexschool.io/v2//api/brunoyu2022/admin/order/${this.orderShow.id}`;this.$http.delete(e).then((()=>{this.$refs.delModal.closeModal(),this.getOrders(this.currentPage)})).catch((e=>{alert(e.response,"錯誤訊息")}))}},created(){this.getOrders()},updated(){this.getOrders()}};const pe=(0,de.Z)(he,[["render",k]]);var _e=pe}}]);
//# sourceMappingURL=75.59e0c52a.js.map